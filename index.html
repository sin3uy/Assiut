<html><head><base href="https://webdevwebsite.com">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù…ØªØ¬Ø± Ø³ÙŠÙ†Ø§ÙˆÙŠ - ÙØ§ØªÙˆØ±Ø©</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
<style>
    body {
        font-family: 'Cairo', Arial, sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
        margin: 0;
        background-color: #e3f2fd;
        direction: rtl;
    }

    .container {
        width: 90%;
        max-width: 600px;
        margin: 20px auto;
    }

    .watermark {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) rotate(-45deg);
        font-size: 24px;
        color: rgba(46, 125, 50, 0.4);
        font-weight: bold;
        pointer-events: none;
        white-space: nowrap;
        z-index: 1;
        background: rgba(255, 255, 255, 0.9);
        padding: 10px 20px;
        border: 2px solid rgba(46, 125, 50, 0.4);
        border-radius: 25px;
        text-shadow: 1px 1px 2px rgba(255, 255, 255, 1);
    }

    .invoice-wrapper {
        position: relative;
        background: #e3f2fd;
        border-radius: 20px;
        overflow: hidden;
        box-shadow: 0 0 20px rgba(13, 71, 161, 0.2);
        display: none;
        margin: 20px;
        border: 1px solid #1565c0; /* Add border to wrapper */
    }

    .invoice-header {
        background-color: #1a237e;
        color: white;
        padding: 5px;
        text-align: center;
        font-size: 14px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .invoice-footer {
        background-color: #1a237e;
        color: white;
        padding: 5px;
        text-align: center;
        font-size: 14px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .invoice-table {
        width: 100%;
        border-collapse: collapse;
        background-color: #bbdefb;
        margin: 0;
        border: 1px solid #1565c0; /* Add outer border */
    }

    .invoice-table td {
        padding: 12px;
        border: 1px solid #1565c0;
        font-family: 'Cairo', Arial, sans-serif;
        text-align: right; /* Change to right alignment */
        vertical-align: middle; /* Center vertically */
        line-height: 1.4; /* Improve line height */
        width: 50%; /* Make columns equal width */
    }

    /* First column (labels) */
    .invoice-table td:first-child {
        white-space: nowrap; /* Prevent label wrapping */
        width: 40%; /* Make label column slightly smaller */
        background-color: #e3f2fd; /* Lighter background for labels */
    }

    /* Second column (values) */
    .invoice-table td:last-child {
        width: 60%; /* Make value column slightly larger */
        word-wrap: break-word; /* Allow long text to wrap */
        max-width: 0; /* Force text wrapping */
    }
 
   /* Adjust accumulated bonus text */
   #accumulatedBonus span {
       display: inline-block;
       margin-right: 5px;
   }

    .invoice-table tr:nth-child(odd) {
        background-color: #bbdefb;
    }

    #inputArea {
        width: 100%;
        height: 200px;
        margin: 20px 0;
        padding: 10px;
        border-radius: 5px;
        border: 1px solid #1a237e;
        background-color: white;
    }

    button {
        background-color: #1a237e;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-family: 'Cairo', Arial, sans-serif;
        transition: background-color 0.3s;
    }

    button:hover {
        background-color: #0d47a1;
    }

    .download-btn {
        display: none;
        margin: 20px 0;
    }

    /* Adjust icon alignment */
    .invoice-table i {
        margin-left: 8px;
        vertical-align: middle;
        width: 20px; /* Fixed width for icons */
        text-align: center;
    }

    .success-order {
        color: #2e7d32;
        font-weight: bold;
    }

    .success-order i {
        color: #2e7d32;
    }

    .discount-applied {
        color: #2e7d32;
    }

    .discount-not-applied {
        color: #c62828;
    }

    .hidden-row {
        display: none;
    }

    #deductBalanceBtn {
        font-size: 14px;
        padding: 10px 20px;
        margin: 20px 0;
        background-color: #2e7d32;
        display: none;
        width: auto;
    }

    #deductBalanceBtn:hover {
        background-color: #1b5e20;
    }

    @media screen and (max-width: 600px) {
        .container {
            width: 95%;
        }
        .invoice-table td {
            padding: 8px;
            font-size: 14px;
        }
    }

    @media print {
        body * {
            visibility: hidden;
        }
        .invoice-wrapper, .invoice-wrapper * {
            visibility: visible;
        }
        .invoice-wrapper {
            position: absolute;
            left: 0;
            top: 0;
        }
    }
</style>
</head>
<body>
    <div class="container">
        <textarea id="inputArea" placeholder="Ø§Ø¯Ø®Ù„ Ù†Øµ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ù‡Ù†Ø§..."></textarea>
        <button onclick="generateInvoice()">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</button>
        
        <div class="invoice-wrapper" id="invoiceWrapper">
            <div class="invoice-header">
                <h3>ÙØ§ØªÙˆØ±Ø© Ù…ØªØ¬Ø± Ø³ÙŠÙ†Ø§ÙˆÙŠ</h3>
            </div>
            
            <div class="invoice-container">
                <div class="watermark">ØªÙ… Ø§Ù„Ø´Ø­Ù† Ø¨Ù†Ø¬Ø§Ø­</div>
                <table class="invoice-table" id="invoiceTable">
                    <tr>
                        <td><i class="fas fa-shopping-cart"></i> Ù†ÙˆØ¹ Ø§Ù„Ø·Ù„Ø¨</td>
                        <td id="orderType" class="success-order"><i class="fas fa-check-circle"></i> Ø·Ù„Ø¨ Ù†Ø§Ø¬Ø­</td>
                    </tr>
                    <tr>
                        <td><i class="fas fa-id-card"></i> Ø§Ù„Ù„Ø§Ø¹Ø¨</td>
                        <td id="playerId"></td>
                    </tr>
                    <tr>
                        <td><i class="fas fa-gamepad"></i> Ø¹Ø¯Ø¯ Ø§Ù„Ø´Ø¯Ø§Øª</td>
                        <td id="amount"></td>
                    </tr>
                    <tr>
                        <td><i class="fas fa-mobile-alt"></i> Ø§Ù„Ø±Ù‚Ù…</td>
                        <td id="phone"></td>
                    </tr>
                    <tr>
                        <td><i class="fas fa-dollar-sign"></i> Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</td>
                        <td id="totalPrice"></td>
                    </tr>
                    <tr>
                        <td><i class="fas fa-hashtag"></i> Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©</td>
                        <td id="transactionId"></td>
                    </tr>
                    <tr>
                        <td><i class="fab fa-whatsapp"></i> Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨</td>
                        <td id="whatsapp"></td>
                    </tr>
                    <tr>
                        <td><i class="fas fa-calendar-alt"></i> ØªØ§Ø±ÙŠØ® Ø§ØµØ¯Ø§Ø± Ø§Ù„ÙØ§ØªÙˆØ±Ø©</td>
                        <td id="date"></td>
                    </tr>
                    <tr>
                        <td><i class="fas fa-gift"></i> Ø±ØµÙŠØ¯Ùƒ Ù‡Ø¯ÙŠØ© Ø§Ù„Ø´Ø±Ø§Ø¡</td>
                        <td id="accumulatedBonus">0 Ø¬Ù†ÙŠÙ‡ <span style="font-size: 12px; color: #666;">(Ù‚Ø§Ø¨Ù„ Ù„Ù„Ø³Ø­Ø¨ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ 5 Ø¬Ù†ÙŠÙ‡)</span></td>
                    </tr>
                    <tr class="hidden-row" id="discountAmountRow">
                        <td><i class="fas fa-percent"></i> Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®ØµÙ…</td>
                        <td id="discountAmount"></td>
                    </tr>
                </table>
            </div>
            
            <div class="invoice-footer">
                <p>Ø´ÙƒØ±Ø§Ù‹ Ù„ØªØ¹Ø§Ù…Ù„Ùƒ Ù…Ø¹ Ù…ØªØ¬Ø± Ø³ÙŠÙ†Ø§ÙˆÙŠ</p>
            </div>
        </div>

        <button id="deductBalanceBtn" onclick="promptPassword()" style="display: none; margin: 20px 0;">Ø®ØµÙ… Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ØªØ±Ø§ÙƒÙ…</button>
        <button class="download-btn" onclick="downloadAsPNG()">ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</button>
    </div>

    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script>
        const BOT_TOKEN = '7770943290:AAGlBA3P5_H6qlgzE0pnjmNj8hfqK5CsAfM';
        const CHAT_ID = '7785980587';
        let playerBonuses = JSON.parse(localStorage.getItem('playerBonuses') || '{}');
        
        async function sendPlayerStats(playerId, amount) {
            if (!playerBonuses[playerId]) {
                playerBonuses[playerId] = 0;
            }
            let newBonus = 0;
            const shedat = parseInt(amount);
            if (shedat >= 4000) {
                newBonus = 10;
            } else if (shedat >= 1200) {
                newBonus = 5;
            } else if (shedat >= 360) {
                newBonus = 3;
            } else if (shedat >= 120) {
                newBonus = 2;
            } else if (shedat >= 60) {
                newBonus = 1;
            }
            if (shedat <= 30) {
                newBonus = 0;
            }
            playerBonuses[playerId] += newBonus;
            localStorage.setItem('playerBonuses', JSON.stringify(playerBonuses));

            document.getElementById('accumulatedBonus').textContent = `${playerBonuses[playerId]} Ø¬Ù†ÙŠÙ‡ `;
            document.getElementById('accumulatedBonus').innerHTML += `<span style="font-size: 12px; color: #666;">(Ù‚Ø§Ø¨Ù„ Ù„Ù„Ø³Ø­Ø¨ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ 5 Ø¬Ù†ÙŠÙ‡)</span>`;

            const message = `
ğŸ® Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ‘¤ Ù…Ø¹Ø±Ù Ø§Ù„Ù„Ø§Ø¹Ø¨: ${playerId}
ğŸ® Ø¹Ø¯Ø¯ Ø§Ù„Ø´Ø¯Ø§Øª: ${amount}
ğŸ’° Ø§Ù„Ù…ÙƒØ§ÙØ£Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©: ${newBonus} Ø¬Ù†ÙŠÙ‡
ğŸ’ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª Ø§Ù„Ù…ØªØ±Ø§ÙƒÙ…Ø©: ${playerBonuses[playerId]} Ø¬Ù†ÙŠÙ‡
â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â° ÙˆÙ‚Øª Ø§Ù„Ø·Ù„Ø¨: ${new Date().toLocaleString('ar-EG')}
ğŸ’ ØªÙ†Ø¨ÙŠÙ‡: Ù‚Ù… Ø¨ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª Ù„Ù‡Ø°Ø§ Ø§Ù„Ù„Ø§Ø¹Ø¨
`;
            try {
                const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        chat_id: CHAT_ID,
                        text: message,
                        parse_mode: 'HTML'
                    })
                });
                
                const data = await response.json();
                if (!data.ok) {
                    console.error('Error sending message to Telegram:', data);
                }
            } catch (error) {
                console.error('Failed to send stats to Telegram:', error);
            }
        }

        function generateInvoice() {
            const input = document.getElementById('inputArea').value;

            document.getElementById('orderType').innerHTML = '<i class="fas fa-check-circle"></i> Ø·Ù„Ø¨ Ù†Ø§Ø¬Ø­';
            
            const playerId = input.match(/ğŸ¯ ğŸ†” Ø§Ù„Ù„Ø§Ø¹Ø¨:\((\d+)\)/)?.[1] || '';
            const amount = input.match(/ğŸ® Ø¹Ø¯Ø¯ Ø§Ù„Ø´Ø¯Ø§Øª: (\d+)/)?.[1] || '';
            const phone = input.match(/ğŸ“± Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø°ÙŠ Ø­ÙˆÙ„Øª Ù…Ù†Ù‡: (\d+)/)?.[1] || '';
            const totalPrice = input.match(/ğŸ’µ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: (.+?)[\nâ– ]/)?.[1] || '';
            const transactionId = input.match(/ğŸ”¢ Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©: ([A-Z0-9]+)/)?.[1] || '';
            const whatsapp = input.match(/ğŸ“ Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨: (\d+)/)?.[1] || '';

            if (playerId) {
                sendPlayerStats(playerId, amount);
            }

            document.getElementById('playerId').textContent = playerId;
            document.getElementById('amount').textContent = amount;
            document.getElementById('phone').textContent = phone;
            document.getElementById('totalPrice').textContent = totalPrice;
            document.getElementById('transactionId').textContent = transactionId;
            document.getElementById('whatsapp').innerHTML = whatsapp ? `<a href="https://wa.me/+2${whatsapp}">${whatsapp}</a>` : '';

            const currentDate = new Date().toLocaleDateString('ar-EG', {
                year: 'numeric',
                month: 'numeric', 
                day: 'numeric'
            });
            document.getElementById('date').textContent = currentDate;

            const playerAccumulatedBonus = playerBonuses[playerId] || 0; // Get player's accumulated bonuses
            document.getElementById('accumulatedBonus').textContent = `${playerAccumulatedBonus} Ø¬Ù†ÙŠÙ‡ `;
            document.getElementById('accumulatedBonus').innerHTML += `<span style="font-size: 12px; color: #666;">(Ù‚Ø§Ø¨Ù„ Ù„Ù„Ø³Ø­Ø¨ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ 5 Ø¬Ù†ÙŠÙ‡)</span>`; // Display accumulated bonuses
            
            const discountUsed = input.includes('ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ…: Ù†Ø¹Ù…'); 
            const totalDiscount = input.match(/Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®ØµÙ… Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: (.+?) Ø¬Ù†ÙŠÙ‡/)?.[1] || '';

            if (discountUsed || totalDiscount) {
                document.getElementById('discountAmountRow').classList.remove('hidden-row');
                document.getElementById('discountAmount').textContent = `${totalDiscount} Ø¬Ù†ÙŠÙ‡`;
            } else {
                document.getElementById('discountAmountRow').classList.add('hidden-row');
            }

            document.querySelector('.invoice-wrapper').style.display = 'block';
            document.querySelector('.download-btn').style.display = 'block';
            document.getElementById('deductBalanceBtn').style.display = 'block'; // Show deduct button
        }

        function promptPassword() {
            const password = prompt("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:");
            if (password === "147") {
                deductBalance();
            } else {
                alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©");
            }
        }

        async function deductBalance() {
            const playerId = document.getElementById('playerId').textContent;
            if (!playerId || !playerBonuses[playerId]) {
                alert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±ØµÙŠØ¯ Ù…ØªØ±Ø§ÙƒÙ… Ù„Ù‡Ø°Ø§ Ø§Ù„Ù„Ø§Ø¹Ø¨');
                return;
            }

            const currentBonus = playerBonuses[playerId];
            const message = `
ğŸ’° ØªÙ… Ø®ØµÙ… Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ØªØ±Ø§ÙƒÙ…
â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ‘¤ Ù…Ø¹Ø±Ù Ø§Ù„Ù„Ø§Ø¹Ø¨: ${playerId}
ğŸ’ Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø®ØµÙˆÙ…: ${currentBonus} Ø¬Ù†ÙŠÙ‡
â° ÙˆÙ‚Øª Ø§Ù„Ø®ØµÙ…: ${new Date().toLocaleString('ar-EG')}
â”â”â”â”â”â”â”â”â”â”â”â”â”â”
`;

            try {
                const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        chat_id: CHAT_ID,
                        text: message,
                        parse_mode: 'HTML'
                    })
                });
                
                if (response.ok) {
                    playerBonuses[playerId] = 0;
                    localStorage.setItem('playerBonuses', JSON.stringify(playerBonuses));
                    document.getElementById('accumulatedBonus').textContent = '0 Ø¬Ù†ÙŠÙ‡ ';
                    document.getElementById('accumulatedBonus').innerHTML += `<span style="font-size: 12px; color: #666;">(Ù‚Ø§Ø¨Ù„ Ù„Ù„Ø³Ø­Ø¨ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ 5 Ø¬Ù†ÙŠÙ‡)</span>`;
                    alert('ØªÙ… Ø®ØµÙ… Ø§Ù„Ø±ØµÙŠØ¯ Ø¨Ù†Ø¬Ø§Ø­');
                }
            } catch (error) {
                console.error('Failed to send deduction message:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø®ØµÙ… Ø§Ù„Ø±ØµÙŠØ¯');
            }
        }

        function downloadAsPNG() {
            const element = document.getElementById('invoiceWrapper');
            const options = {
                backgroundColor: null,
                scale: 2,
                borderRadius: 20,
            };
            
            html2canvas(element, options).then(function(canvas) {
                const link = document.createElement('a');
                link.download = 'ÙØ§ØªÙˆØ±Ø©_Ø³ÙŠÙ†Ø§ÙˆÙŠ.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
            });
        }
    </script>
</body></html>